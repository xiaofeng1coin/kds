{% extends "base.html" %}
{% block content %}
<div class="card h-100">
    <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0 brand-font">系统运行日志</h5>
        <div>
            <button class="btn btn-outline-primary btn-sm" onclick="loadLogs()"><i class="bi bi-arrow-clockwise"></i> 刷新</button>
            <button class="btn btn-outline-danger btn-sm" onclick="clearLogs()"><i class="bi bi-trash"></i> 清空</button>
        </div>
    </div>
    <div class="card-body p-0">
        <div id="logContainer" class="bg-light p-3 small" style="height: 600px; overflow-y: scroll; color: #2d3436; font-family: Consolas, monospace;">
            正在加载...
        </div>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', loadLogs);
    function loadLogs() {
        const container = document.getElementById('logContainer');
        fetch('/api/get_system_logs').then(r=>r.json()).then(data => {
            if(data.status === 'success') {
                container.innerHTML = data.logs.length ? data.logs.join('<br>') : '<div class="text-center text-muted mt-5">暂无日志</div>';
                container.scrollTop = container.scrollHeight;
            }
        });
    }
    function clearLogs() {
        asyncSwalConfirm('清空日志?', '此操作不可撤销').then(res => {
            if(res) fetch('/api/clear_system_logs', {method:'POST'}).then(() => loadLogs());
        });
    }
</script>
{% endblock %}